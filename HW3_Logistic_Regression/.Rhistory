summary(logit_reduced)
coefs2 <- summary(logit_reduced)$coefficients
OR2 <- exp(coef(logit_reduced))
low2 <- exp(coef(logit_reduced) - 1.96 * coefs2[, "Std. Error"])
high2 <- exp(coef(logit_reduced) + 1.96 * coefs2[, "Std. Error"])
merged2 <- cbind(coefs2, OR2, low2, high2)
kable(merged2, digits = 3)
AIC(logit_full, logit_reduced)
for (i in seq_along(cutoffs)) {
c <- cutoffs[i]
pred <- ifelse(phat >= c, 1, 0)
TP <- sum(pred==1 & y==1)
TN <- sum(pred==0 & y==0)
FP <- sum(pred==1 & y==0)
FN <- sum(pred==0 & y==1)
cutoff_results$Sensitivity[i] <- TP/(TP+FN)
cutoff_results$Specificity[i] <- TN/(TN+FP)
cutoff_results$Misclass[i] <- (FP+FN)/length(y)
}
kable(cutoff_results, digits = 3)
cutoffs <- c(0.02,0.03,0.05,0.07,0.08,0.09,0.10,0.15,0.20,0.50)
y <- cdc_data$DRINKING_D
phat <- logit_full$fitted.values
cutoff_results <- data.frame(
Cutoff = cutoffs,
Sensitivity = NA,
Specificity = NA,
Misclass = NA
)
cutoff_results
library(aod)
library(ggplot2)
library(rms)
library(gmodels)
library(nnet)
library(DAAG)
library(ROCR)
library(xtable)
library(kableExtra)
library(ROCR)
options(scipen = 999)
cdc_data <- read.csv("data/logistic_regression.csv")
head(cdc_data)
DRINKING_D.tab <- table(cdc_data$DRINKING_D)
prop.table(DRINKING_D.tab)
# I made a function to loop through it so I don't have to do this 7 separate times.
predictors <- c(
"FATAL_OR_M", "OVERTURNED", "CELL_PHONE",
"SPEEDING", "AGGRESSIVE",
"DRIVER1617", "DRIVER65PLUS"
)
for (var in predictors) {
cat("============================================================\n")
cat("PREDICTOR:", var, "\n")
# Counts.
table_counts <- table(cdc_data$DRINKING_D, cdc_data[[var]])
print(table_counts)
# Row percentages within DRINKING_D.
cat("\nROW % WITHIN DRINKING_D:\n")
print(round(prop.table(table_counts, 1), 4))
# Total number of predictors = 1 in the entire dataset.
cat("\nTOTAL", var, "= 1 IN FULL DATASET:", sum(cdc_data[[var]] == 1), "\n")
cat("\nCROSSTABLE OUTPUT:")
CrossTable(cdc_data$DRINKING_D,
cdc_data[[var]],
prop.r = FALSE,
prop.t = FALSE,
prop.chisq = FALSE,
chisq = TRUE)
}
# Build summary table for 2.b.iii
binary_summary <- data.frame(
Predictor = character(),
DRINKING_D = integer(),
Count_1 = integer(),
Percent_1 = numeric(),
Total_1 = integer(),
stringsAsFactors = FALSE
)
for (var in predictors) {
tab <- table(DRINKING_D = cdc_data$DRINKING_D,
Predictor = cdc_data[[var]])
row_props <- prop.table(tab, 1)
total_1 <- sum(tab[, "1"])
for (d in rownames(tab)) {
binary_summary <- rbind(
binary_summary,
data.frame(
Predictor = var,
DRINKING_D = as.integer(d),
Count_1 = as.integer(tab[d, "1"]),
Percent_1 = 100 * as.numeric(row_props[d, "1"]),
Total_1 = total_1
)
)
}
}
binary_summary$DRINKING_D <- ifelse(
binary_summary$DRINKING_D == 0, "No Alcohol", "Alcohol"
)
kable(binary_summary, digits = 2)
chi_results <- data.frame(
Predictor = predictors,
Chi_sq = NA_real_,
df = 1,
p_value = NA_real_
)
for (i in seq_along(predictors)) {
var <- predictors[i]
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
test <- chisq.test(tab, correct = FALSE)
chi_results$Chi_sq[i] <- test$statistic
chi_results$p_value[i] <- test$p.value
}
kable(chi_results, digits = 4)
binary_summary2 <- merge(binary_summary, chi_results, by = "Predictor")
kable(binary_summary2, digits = 3)
continuous_vars <- c("PCTBACHMOR", "MEDHHINC")
mean_sd_table <- do.call(rbind, lapply(continuous_vars, function(v) {
data.frame(
Predictor = v,
Group = c("No Alcohol", "Alcohol"),
Mean = tapply(cdc_data[[v]], cdc_data$DRINKING_D, mean),
SD = tapply(cdc_data[[v]], cdc_data$DRINKING_D, sd)
)
}))
kable(mean_sd_table, digits = 2)
t_PCTB <- t.test(cdc_data$PCTBACHMOR ~ cdc_data$DRINKING_D)
t_MEDH <- t.test(cdc_data$MEDHHINC ~ cdc_data$DRINKING_D)
t_table <- data.frame(
Predictor = c("PCTBACHMOR", "MEDHHINC"),
t_stat = c(t_PCTB$statistic, t_MEDH$statistic),
df = c(t_PCTB$parameter, t_MEDH$parameter),
p_value = c(t_PCTB$p.value, t_MEDH$p.value)
)
kable(t_table, digits = 4)
mean_sd_table2 <- merge(mean_sd_table, t_table, by = "Predictor")
kable(mean_sd_table2, digits = 4)
all_predictors <- c(
predictors,
"PCTBACHMOR", "MEDHHINC"
)
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
kable(corr_matrix, digits = 3)
logit_full <- glm(DRINKING_D ~
FATAL_OR_M + OVERTURNED + CELL_PHONE +
SPEEDING + AGGRESSIVE + DRIVER1617 + DRIVER65PLUS +
PCTBACHMOR + MEDHHINC,
family = binomial, data = cdc_data
)
summary(logit_full)
coefs <- summary(logit_full)$coefficients
OR <- exp(coef(logit_full))
lower <- exp(coef(logit_full) - 1.96 * coefs[, "Std. Error"])
upper <- exp(coef(logit_full) + 1.96 * coefs[, "Std. Error"])
merged <- cbind(coefs, OR, lower, upper)
kable(merged, digits = 3)
cutoffs <- c(0.02,0.03,0.05,0.07,0.08,0.09,0.10,0.15,0.20,0.50)
y <- cdc_data$DRINKING_D
phat <- logit_full$fitted.values
cutoff_results <- data.frame(
Cutoff = cutoffs,
Sensitivity = NA,
Specificity = NA,
Misclass = NA
)
cutoff_results
cutoff_results
# I made a function to loop through it so I don't have to do this 7 separate times.
# Create predictor vector.
predictors <- c(
"FATAL_OR_M", "OVERTURNED", "CELL_PHONE",
"SPEEDING", "AGGRESSIVE",
"DRIVER1617", "DRIVER65PLUS"
)
# Create an empty results dataframe.
binary_results <- data.frame(
Predictor = character(),
Drink0_Count_1 = numeric(),
Drink1_Count_1 = numeric(),
Total_1 = numeric(),
ChiSq = numeric(),
p_value = numeric(),
stringsAsFactors = FALSE
)
# Loop through each predictor.
for (var in predictors) {
cat("=======================================================\n")
cat("PREDICTOR:", var, "\n")
# Build 2x2 table.
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
print(tab)
# Row percentages.
cat("\nRow percentages (within DRINKING_D):\n")
print(round(prop.table(tab, 1), 4))
# Count the number of 1's.
total_ones <- sum(cdc_data[[var]] == 1)
cat("\nTotal number of", var, "= 1 in dataset:", total_ones, "\n")
# Chi-square test.
test <- chisq.test(tab, correct = FALSE)
cat("\nChi-square statistic:", test$statistic,
"\nDegrees of freedom:", test$parameter,
"\np-value:", test$p.value, "\n")
# Add row to results dataframe.
binary_results <- rbind(
binary_results,
data.frame(
Predictor = var,
Drink0_Count_1 = tab["0", "1"],
Drink1_Count_1 = tab["1", "1"],
Total_1 = total_ones,
ChiSq = unname(test$statistic),
p_value = test$p.value
)
)
}
kable(
binary_results,
digits = 3,
caption = "Binary Predictors: Counts of 1s by DRINKING_D, total 1s, and Chi-square test results."
)
# Create empty table for continuous predictor results
cont_results <- data.frame(
Predictor = character(),
Mean_D0 = numeric(),
Mean_D1 = numeric(),
SD_D0 = numeric(),
SD_D1 = numeric(),
t_stat = numeric(),
df = numeric(),
p_value = numeric(),
stringsAsFactors = FALSE
)
continuous_vars <- c("PCTBACHMOR", "MEDHHINC")
for (v in continuous_vars) {
# Means
mean0 <- mean(cdc_data[cdc_data$DRINKING_D==0, v], na.rm=TRUE)
mean1 <- mean(cdc_data[cdc_data$DRINKING_D==1, v], na.rm=TRUE)
# SDs
sd0 <- sd(cdc_data[cdc_data$DRINKING_D==0, v], na.rm=TRUE)
sd1 <- sd(cdc_data[cdc_data$DRINKING_D==1, v], na.rm=TRUE)
# t-test
ttest <- t.test(cdc_data[[v]] ~ cdc_data$DRINKING_D)
# Add row
cont_results <- rbind(
cont_results,
data.frame(
Predictor = v,
Mean_D0 = mean0,
Mean_D1 = mean1,
SD_D0 = sd0,
SD_D1 = sd1,
t_stat = unname(ttest$statistic),
df = unname(ttest$parameter),
p_value = ttest$p.value
)
)
}
cont_results
binary_summary2 <- merge(binary_summary, chi_results, by = "Predictor")
kable(binary_summary2, digits = 3)
logit_reduced <- glm(DRINKING_D ~
FATAL_OR_M + OVERTURNED + CELL_PHONE +
SPEEDING + AGGRESSIVE + DRIVER1617 + DRIVER65PLUS,
data = cdc_data,
family = binomial
)
summary(logit_reduced)
reduced_coefs <- summary(logit_reduced)$coefficients
OR2 <- exp(coef(logit_reduced))
CI2 <- exp(confint(logit_reduced))
reduced_logit_results <- cbind(
reduced_coefs,
OR = OR2,
CI_low = CI2[,1],
CI_high = CI2[,2]
)
kable(
reduced_logit_results,
digits = 3,
caption="Reduced Logistic Model: Coefficients, OR, CI"
)
pred <- prediction(phat, y)
perf <- performance(pred, "tpr", "fpr")
plot(perf, main="ROC Curve")
abline(0,1,lty = 2)
auc_value <- performance(pred, "auc")@y.values[[1]]
auc_value
coefs <- summary(logit_full)$coefficients
OR <- exp(coef(logit_full))
CI <- exp(confint(logit_full))
full_logit_results <- cbind(
coefs,
OR = OR,
CI_low = CI[,1],
CI_high = CI[,2]
)
kable(
full_logit_results,
digits=3,
caption = "Logistic Regression: Coefficients, OR, and CI"
)
coefs <- summary(logit_full)$coefficients
OR <- exp(coef(logit_full))
lower <- exp(coef(logit_full) - 1.96 * coefs[, "Std. Error"])
upper <- exp(coef(logit_full) + 1.96 * coefs[, "Std. Error"])
merged <- cbind(coefs, OR, lower, upper)
kable(merged, digits = 3)
library(aod)
library(ggplot2)
library(rms)
library(gmodels)
library(nnet)
library(DAAG)
library(ROCR)
library(xtable)
library(kableExtra)
library(ROCR)
options(scipen = 999)
cdc_data <- read.csv("data/logistic_regression.csv")
head(cdc_data)
DRINKING_D.tab <- table(cdc_data$DRINKING_D)
prop.table(DRINKING_D.tab)
# I made a function to loop through it so I don't have to do this 7 separate times.
# Create predictor vector.
predictors <- c(
"FATAL_OR_M", "OVERTURNED", "CELL_PHONE",
"SPEEDING", "AGGRESSIVE",
"DRIVER1617", "DRIVER65PLUS"
)
# Create an empty results dataframe.
binary_results <- data.frame(
Predictor = character(),
Drink0_Count_1 = numeric(),
Drink1_Count_1 = numeric(),
Total_1 = numeric(),
ChiSq = numeric(),
p_value = numeric(),
stringsAsFactors = FALSE
)
# Loop through each predictor.
for (var in predictors) {
cat("=======================================================\n")
cat("PREDICTOR:", var, "\n")
# Build 2x2 table.
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
print(tab)
# Row percentages.
cat("\nRow percentages (within DRINKING_D):\n")
print(round(prop.table(tab, 1), 4))
# Count the number of 1's.
total_ones <- sum(cdc_data[[var]] == 1)
cat("\nTotal number of", var, "= 1 in dataset:", total_ones, "\n")
# Chi-square test.
test <- chisq.test(tab, correct = FALSE)
cat("\nChi-square statistic:", test$statistic,
"\nDegrees of freedom:", test$parameter,
"\np-value:", test$p.value, "\n")
# Add row to results dataframe.
binary_results <- rbind(
binary_results,
data.frame(
Predictor = var,
Drink0_Count_1 = tab["0", "1"],
Drink1_Count_1 = tab["1", "1"],
Total_1 = total_ones,
ChiSq = unname(test$statistic),
p_value = test$p.value
)
)
}
# Build summary table.
binary_summary <- data.frame(
Predictor = character(),
DRINKING_D = integer(),
Count_1 = integer(),
Percent_1 = numeric(),
Total_1 = integer(),
stringsAsFactors = FALSE
)
for (var in predictors) {
tab <- table(DRINKING_D = cdc_data$DRINKING_D,
Predictor   = cdc_data[[var]])
row_props <- prop.table(tab, 1)
total_1 <- sum(tab[, "1"])
for (d in rownames(tab)) {
binary_summary <- rbind(
binary_summary,
data.frame(
Predictor  = var,
DRINKING_D = as.integer(d),
Count_1    = as.integer(tab[d, "1"]),
Percent_1  = 100 * as.numeric(row_props[d, "1"]),
Total_1    = total_1
)
)
}
}
binary_summary$DRINKING_D <- ifelse(
binary_summary$DRINKING_D == 0, "No Alcohol", "Alcohol"
)
kable(binary_summary, digits = 2)
chi_results <- data.frame(
Predictor = predictors,
Chi_sq = NA_real_,
df = 1,
p_value = NA_real_
)
for (i in seq_along(predictors)) {
var <- predictors[i]
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
test <- chisq.test(tab, correct = FALSE)
chi_results$Chi_sq[i] <- test$statistic
chi_results$p_value[i] <- test$p.value
}
kable(chi_results, digits = 4)
binary_summary2 <- merge(binary_summary, chi_results, by = "Predictor")
kable(binary_summary2, digits = 3)
continuous_vars <- c("PCTBACHMOR", "MEDHHINC")
mean_sd_table <- do.call(rbind, lapply(continuous_vars, function(v) {
data.frame(
Predictor = v,
Group = c("No Alcohol", "Alcohol"),
Mean = tapply(cdc_data[[v]], cdc_data$DRINKING_D, mean),
SD = tapply(cdc_data[[v]], cdc_data$DRINKING_D, sd)
)
}))
kable(mean_sd_table, digits = 2)
t_PCTB <- t.test(cdc_data$PCTBACHMOR ~ cdc_data$DRINKING_D)
t_MEDH <- t.test(cdc_data$MEDHHINC ~ cdc_data$DRINKING_D)
t_table <- data.frame(
Predictor = c("PCTBACHMOR", "MEDHHINC"),
t_stat = c(t_PCTB$statistic, t_MEDH$statistic),
df = c(t_PCTB$parameter, t_MEDH$parameter),
p_value = c(t_PCTB$p.value, t_MEDH$p.value)
)
kable(t_table, digits = 4)
mean_sd_table2 <- merge(mean_sd_table, t_table, by = "Predictor")
kable(mean_sd_table2, digits = 4)
all_predictors <- c(
predictors,
"PCTBACHMOR", "MEDHHINC"
)
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
kable(corr_matrix, digits = 3)
logit_full <- glm(DRINKING_D ~
FATAL_OR_M + OVERTURNED + CELL_PHONE +
SPEEDING + AGGRESSIVE + DRIVER1617 + DRIVER65PLUS +
PCTBACHMOR + MEDHHINC,
family = binomial,
data = cdc_data
)
summary(logit_full)
coefs <- summary(logit_full)$coefficients
OR <- exp(coef(logit_full))
lower <- exp(coef(logit_full) - 1.96 * coefs[, "Std. Error"])
upper <- exp(coef(logit_full) + 1.96 * coefs[, "Std. Error"])
merged <- cbind(coefs, OR, lower, upper)
kable(merged, digits = 3)
cutoffs <- c(0.02, 0.03, 0.05, 0.07, 0.08, 0.09, 0.10, 0.15, 0.20, 0.50)
phat <- logit_full$fitted.values
y <- cdc_data$DRINKING_D
cutoff_table <- data.frame(
Cutoff = cutoffs,
Sensitivity = NA,
Specificity = NA,
Misclass = NA
)
for (i in seq_along(cutoffs)) {
c <- cutoffs[i]
pred <- ifelse(phat >= c, 1, 0)
TP <- sum(pred == 1 & y == 1)
TN <- sum(pred == 0 & y == 0)
FP <- sum(pred == 1 & y == 0)
FN <- sum(pred == 0 & y == 1)
cutoff_table$Sensitivity[i] <- TP/(TP+FN)
cutoff_table$Specificity[i] <- TN/(TN+FP)
cutoff_table$Misclass[i] <- (FP+FN)/length(y)
}
kable(
cutoff_table,
digits = 3,
caption = "Sensitivity, Specificity, and Misclassification Across Cutoffs"
)
pred <- prediction(phat, y)
perf <- performance(pred, "tpr", "fpr")
plot(perf, main="ROC Curve")
abline(0,1,lty = 2)
auc_value <- performance(pred, "auc")@y.values[[1]]
auc_value
logit_reduced <- glm(DRINKING_D ~
FATAL_OR_M + OVERTURNED + CELL_PHONE +
SPEEDING + AGGRESSIVE + DRIVER1617 + DRIVER65PLUS,
data = cdc_data,
family = binomial
)
summary(logit_reduced)
reduced_coefs <- summary(logit_reduced)$coefficients
OR2 <- exp(coef(logit_reduced))
CI2 <- exp(confint(logit_reduced))
reduced_logit_results <- cbind(
reduced_coefs,
OR = OR2,
CI_low = CI2[,1],
CI_high = CI2[,2]
)
kable(
reduced_logit_results,
digits = 3,
caption="Reduced Logistic Model: Coefficients, OR, CI"
)
AIC(logit_full, logit_reduced)
