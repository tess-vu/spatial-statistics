"MEDHHINC"
)
library(ggcorrplot)
# Calculate correlation matrix
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 2.5,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 2,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
plot.title = element_blank(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
plot.title = element_text(hjust = 0.5)
)
#| fig-width: 8
#| fig-height: 8
#| fig-dpi: 300
# 1. Define all predictors (binary and continuous)
all_predictors <- c(
predictors
)
# Calculate correlation matrix
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
plot.title = element_text(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
axis.text.y = element_text(size = 10),
plot.title = element_text(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 2,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5)
)
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 12)
)
#| fig-width: 6
#| fig-height: 6
#| fig-dpi: 300
# 1. Define all predictors (binary and continuous)
all_predictors <- c(
predictors,
"MEDHHINC",
"PCTBACHMOR"
)
library(ggcorrplot)
# Calculate correlation matrix
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
# Create correlation plot
ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 12)
)
ggsave("correlation_matrix.png", plot = pearson_corr, width = 6, height = 6, dpi = 300)
# Create correlation plot
pearson_corr <- ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 12)
)
ggsave("correlation_matrix.png", plot = pearson_corr, width = 6, height = 6, dpi = 300)
library(aod)
library(ggplot2)
library(rms)
library(gmodels)
library(nnet)
library(DAAG)
library(ROCR)
library(xtable)
library(kableExtra)
library(ROCR)
options(scipen = 999)
cdc_data <- read.csv("data/logistic_regression.csv")
head(cdc_data)
DRINKING_D.tab <- table(cdc_data$DRINKING_D)
prop.table(DRINKING_D.tab)
# I made a function to loop through it so I don't have to do this 7 separate times.
# Create predictor vector.
predictors <- c(
"FATAL_OR_M", "OVERTURNED", "CELL_PHONE",
"SPEEDING", "AGGRESSIVE",
"DRIVER1617", "DRIVER65PLUS"
)
# Create an empty results dataframe.
binary_results <- data.frame(
Predictor = character(),
Drink0_Count_1 = numeric(),
Drink1_Count_1 = numeric(),
Total_1 = numeric(),
ChiSq = numeric(),
p_value = numeric(),
stringsAsFactors = FALSE
)
# Loop through each predictor.
for (var in predictors) {
cat("=======================================================\n")
cat("PREDICTOR:", var, "\n")
# Build 2x2 table.
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
print(tab)
# Row percentages.
cat("\nRow percentages (within DRINKING_D):\n")
print(round(prop.table(tab, 1), 4))
# Count the number of 1's.
total_ones <- sum(cdc_data[[var]] == 1)
cat("\nTotal number of", var, "= 1 in dataset:", total_ones, "\n")
# Chi-square test.
test <- chisq.test(tab, correct = FALSE)
cat("\nChi-square statistic:", test$statistic,
"\nDegrees of freedom:", test$parameter,
"\np-value:", test$p.value, "\n")
# Add row to results dataframe.
binary_results <- rbind(
binary_results,
data.frame(
Predictor = var,
Drink0_Count_1 = tab["0", "1"],
Drink1_Count_1 = tab["1", "1"],
Total_1 = total_ones,
ChiSq = unname(test$statistic),
p_value = test$p.value
)
)
}
# Build summary table.
binary_summary <- data.frame(
Predictor = character(),
DRINKING_D = integer(),
Count_1 = integer(),
Percent_1 = numeric(),
Total_1 = integer(),
stringsAsFactors = FALSE
)
for (var in predictors) {
tab <- table(DRINKING_D = cdc_data$DRINKING_D,
Predictor   = cdc_data[[var]])
row_props <- prop.table(tab, 1)
total_1 <- sum(tab[, "1"])
for (d in rownames(tab)) {
binary_summary <- rbind(
binary_summary,
data.frame(
Predictor  = var,
DRINKING_D = as.integer(d),
Count_1    = as.integer(tab[d, "1"]),
Percent_1  = 100 * as.numeric(row_props[d, "1"]),
Total_1    = total_1
)
)
}
}
binary_summary$DRINKING_D <- ifelse(
binary_summary$DRINKING_D == 0, "No Alcohol", "Alcohol"
)
kable(binary_summary, digits = 2)
chi_results <- data.frame(
Predictor = predictors,
Chi_sq = NA_real_,
df = 1,
p_value = NA_real_
)
for (i in seq_along(predictors)) {
var <- predictors[i]
tab <- table(cdc_data$DRINKING_D, cdc_data[[var]])
test <- chisq.test(tab, correct = FALSE)
chi_results$Chi_sq[i] <- test$statistic
chi_results$p_value[i] <- test$p.value
}
kable(chi_results, digits = 4)
binary_summary2 <- merge(binary_summary, chi_results, by = "Predictor")
kable(binary_summary2, digits = 3)
continuous_vars <- c("PCTBACHMOR", "MEDHHINC")
mean_sd_table <- do.call(rbind, lapply(continuous_vars, function(v) {
data.frame(
Predictor = v,
Group = c("No Alcohol", "Alcohol"),
Mean = tapply(cdc_data[[v]], cdc_data$DRINKING_D, mean),
SD = tapply(cdc_data[[v]], cdc_data$DRINKING_D, sd)
)
}))
kable(mean_sd_table, digits = 2)
t_PCTB <- t.test(cdc_data$PCTBACHMOR ~ cdc_data$DRINKING_D)
t_MEDH <- t.test(cdc_data$MEDHHINC ~ cdc_data$DRINKING_D)
t_table <- data.frame(
Predictor = c("PCTBACHMOR", "MEDHHINC"),
t_stat = c(t_PCTB$statistic, t_MEDH$statistic),
df = c(t_PCTB$parameter, t_MEDH$parameter),
p_value = c(t_PCTB$p.value, t_MEDH$p.value)
)
kable(t_table, digits = 4)
mean_sd_table2 <- merge(mean_sd_table, t_table, by = "Predictor")
kable(mean_sd_table2, digits = 4)
#| fig-width: 6
#| fig-height: 6
#| fig-dpi: 300
# 1. Define all predictors (binary and continuous)
all_predictors <- c(
predictors,
"MEDHHINC",
"PCTBACHMOR"
)
library(ggcorrplot)
# Calculate correlation matrix
corr_matrix <- cor(cdc_data[, all_predictors], use = "complete.obs")
# Create correlation plot
pearson_corr <- ggcorrplot(corr_matrix,
hc.order = TRUE,
type = "lower",
lab = TRUE,
lab_size = 3,
colors = c("#0072B2", "white", "#D55E00"),
title = "Pearson Correlation Matrix of Predictors") +
theme(
axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
axis.text.y = element_text(size = 8),
plot.title = element_text(hjust = 0.5, size = 12)
)
pearson_corr
#ggsave("correlation_matrix.png", plot = pearson_corr, width = 6, height = 6, dpi = 300)
logit_full <- glm(DRINKING_D ~
FATAL_OR_M + OVERTURNED + CELL_PHONE +
SPEEDING + AGGRESSIVE + DRIVER1617 + DRIVER65PLUS +
PCTBACHMOR + MEDHHINC,
family = binomial,
data = cdc_data
)
summary(logit_full)
full_coefs <- summary(logit_full)$coefficients
OR2 <- exp(coef(logit_full))
CI2 <- exp(confint(logit_full))
full_logit_results <- cbind(
full_coefs,
OR = OR2,
CI_low = CI2[,1],
CI_high = CI2[,2]
)
# Create table.
full_model <- kbl(full_logit_results,
digits = 2,
# Rename columns.
col.names = c("Estimate", "Standard Error", "Z-Value", "P-Value", "Odds Ratio", "2.5% CI", "97.5% CI"),
align = "c",
caption = "Full Logistic Regression Model (Binary Predictors)") %>%
kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
column_spec(1, bold = T) %>%
footnote(
general = c(
"<i>FATAL_OR_M:</i> Crash resulted in fatality or major injury.",
"<i>OVERTURNED:</i> Crash involved an overturned vehicle.",
"<i>CELL_PHONE:</i> Driver was using cell phone.",
"<i>SPEEDING:</i> Crash involved speeding car.",
"<i>AGGRESSIVE:</i> Crash involved aggressive driving.",
"<i>DRIVER1617:</i> Crash involved at least one driver who was 16 or 17 years old.",
"<i>DRIVER65PLUS:</i> Crash involved at least one driver who was at least 65 years old.",
"<i>PCTBACHMOR:</i> % of individuals 25 years of age or older who have at least a bachelorâ€™s degree.",
"<i>MEDHHINC:</i> Median household income."
),
general_title = "Variable Definitions:",
footnote_as_chunk = FALSE,
escape = FALSE # To allow HTML formatting.
)
# Highlight significant p-values.
#row_spec(which(reduced_logit_results[, "Pr(>|z|)"] < 0.05), bold = T)
full_model
# Save as HTML file.
save_kable(full_model, "full_model.html", zoom = 3, self_contained = TRUE)
# Then convert HTML to PNG using webshot.
webshot::webshot("full_model.html", "full_model.png")
pred <- prediction(phat, y)
perf <- performance(pred, "tpr", "fpr")
plot(perf, main="ROC Curve")
abline(0,1,lty = 2)
auc_value <- performance(pred, "auc")@y.values[[1]]
auc_value
library(ggplot2)
library(ROCR)
# Calculate predictions and performance
pred <- prediction(phat, y)
perf <- performance(pred, "tpr", "fpr")
# Extract data for plotting
roc_data <- data.frame(
fpr = perf@x.values[[1]],
tpr = perf@y.values[[1]]
)
# Calculate AUC
auc_value <- performance(pred, "auc")@y.values[[1]]
# Create nice ROC curve
ggplot(roc_data, aes(x = fpr, y = tpr)) +
geom_line(color = "#0072B2", size = 1.2) +
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "gray50") +
annotate("text", x = 0.75, y = 0.25,
label = paste("AUC =", round(auc_value, 3)),
size = 5, fontface = "bold") +
labs(
title = "ROC Curve for Logistic Regression Model",
x = "False Positive Rate (1 - Specificity)",
y = "True Positive Rate (Sensitivity)"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
axis.title = element_text(size = 12),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank()
) +
coord_equal()
library(pROC)
library(ggplot2)
# Create ROC object
roc_obj <- roc(y, phat)
# Get AUC
auc_value <- auc(roc_obj)
# Plot with ggplot
ggroc(roc_obj, color = "#0072B2", size = 1.2) +
geom_abline(intercept = 1, slope = 1, linetype = "dashed", color = "gray50") +
annotate("text", x = 0.25, y = 0.25,
label = paste("AUC =", round(auc_value, 3)),
size = 5, fontface = "bold") +
labs(
title = "ROC Curve for Logistic Regression Model",
x = "Specificity",
y = "Sensitivity"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
axis.title = element_text(size = 12),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank()
)
# Plot with ggplot
ggroc(roc_obj, color = "#0072B2", size = 1.2) +
geom_abline(intercept = 1, slope = 1, linetype = "dashed", color = "gray50") +
annotate("text", x = 0.25, y = 0.25,
label = paste("AUC =", round(auc_value, 3)),
size = 5, fontface = "bold") +
labs(
title = "ROC Curve",
x = "Specificity",
y = "Sensitivity"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
axis.title = element_text(size = 12),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank()
)
# Plot with ggplot
roc_curve <- ggroc(roc_obj, color = "#0072B2", size = 1.2) +
geom_abline(intercept = 1, slope = 1, linetype = "dashed", color = "gray50") +
annotate("text", x = 0.25, y = 0.25,
label = paste("AUC =", round(auc_value, 3)),
size = 5, fontface = "bold") +
labs(
title = "ROC Curve",
x = "Specificity",
y = "Sensitivity"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
axis.title = element_text(size = 12),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank()
)
ggsave("roc_curve.png", roc_curve, height = 6, width = 6, dpi = 300)
