title = "Percent of Single Detached Homes (Log)",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),  # Inside map, bottom right
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)  # top, right, bottom, left
)
# PCTVACANT
coefPCTVACANT <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTVACANTst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTVACANT",
palette = "-RdBu"
) +
tm_layout(
frame = FALSE,
title = "Percent of Vacancies",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
tmap_arrange(coefLNNBELPOV, coefPCTBACHMOR, coefPCTSINGLES, coefPCTVACANT, ncol = 2, nrow = 2)
tm_shape(regress_data)+
tm_fill(col='localR2',  breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), n=5, palette = 'Blues')+
tm_layout(frame=FALSE)
# Compute Moran's I of residuals for each model to measures remaining spatial autocorrelation.
# The closer the Moran's I statistic is to 0, the better.
moran_ols <- moran.mc(standardised_res, queenlist, 999, alternative = "two.sided")
moran_lag <- moran.mc(lag_reg$residuals, queenlist, 999, alternative = "two.sided")
moran_error <- moran.mc(error_reg$residuals, queenlist, 999, alternative = "two.sided")
moran_gwr <- moran.mc(gwr_model$SDF$gwr.e, queenlist, 999, alternative = "two.sided")
moran_ols
moran_lag
moran_error
moran_gwr
# Compare AIC values.
# The lower the AIC, the better the model fit (after penalization).
aic_ols <- AIC(ols_reg)
aic_lag <- AIC(lag_reg)
aic_error <- AIC(error_reg)
aic_gwr <- gwr_model$results$AICc   # GWR reports a corrected AIC (AICc)
aic_ols
aic_lag
aic_error
aic_gwr
# Compare Log-Likelihoods and Likelihood Ratio Tests.
# Higher log-likelihood = better model fit.
loglik_ols   <- logLik(ols_reg)
loglik_lag   <- logLik(lag_reg)
loglik_error <- logLik(error_reg)
# Likelihood ratio tests
lr_lag_vs_ols   <- LR.Sarlm(lag_reg, ols_reg)
lr_error_vs_ols <- LR.Sarlm(error_reg, ols_reg)
lr_lag_vs_ols
lr_error_vs_ols
# Significant LR test (p < 0.05) = spatial model significantly improves on OLS.
# Compare R-squared values (OLS vs. GWR) GWR = quasi-global R-squared to compare with OLS.
r2_ols <- summary(ols_reg)$r.squared
# OLS comes with the R-squared value, but gwr does not. We need to calculate the R-squared value
y <- regress_data$LNMEDHVAL # Dependent variable vector
r2_gwr <- 1 - (gwr_model$results$rss / sum((y - mean(y))^2))
r2_ols
r2_gwr
# Higher R² = model explains more variance.
# Comparison summary table
comparison <- data.frame(
Model = c("OLS", "Spatial Lag", "Spatial Error", "GWR (Adaptive)"),
# AIC: Lower AIC indicates better model fit after penalization
AIC = c(
AIC(ols_reg),
AIC(lag_reg),
AIC(error_reg),
gwr_model$results$AICc   # Use AICc from GWR
),
# Log-likelihood: Higher value indicates better fit
LogLik = c(
as.numeric(logLik(ols_reg)),
as.numeric(logLik(lag_reg)),
as.numeric(logLik(error_reg)),
NA   # LogLik not reported for GWR
),
# R-squared: Proportion of variance explained
R2 = c(
summary(ols_reg)$r.squared,
NA,  # Not reported for SAR/SEM
NA,  # Not reported for SEM
r2_gwr  # Quasi-global R2
)
)
comparison
# The R-squared of 0.63 for GWR is noticeably higher than OLS’s 0.44, suggesting that the relationships between median income and predictors vary across space. Mapping the local R-squared and standardized coefficients will reveal these spatial variations, confirming that a single global model doesn’t fully capture local dynamics.
#The OLS model explains about 44% of the variance in median household income. However, residual diagnostics and Moran’s I indicate significant spatial autocorrelation, suggesting that OLS does not fully capture the spatial patterns in the data.
#The Spatial Lag and Spatial Error models improve model fit over OLS, as indicated by lower AIC values (1207.83 and 1271.80, respectively) and higher log-likelihoods.
# GWR with an adaptive bandwidth provides the best overall fit, with the lowest AIC (1069.12) and a R² of 0.63. This confirms that a single global regression is insufficient to capture the nuanced spatial relationships, and GWR is better suited for modeling local variation.
map <- tm_shape(regress_data)+
tm_fill(col='localR2',
breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
n=5,
palette = 'Blues',
title = expression(Local~R^2)) +  # Add custom legend title
tm_borders(col = "white", lwd = 0.5) +
tm_layout(frame=FALSE)
map
# Save it
tmap_save(map, filename = "localR2_map.png", width = 8, height = 8, dpi = 300)
# PCTVACANT
coefPCTVACANT <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTVACANTst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTVACANT",
palette = "-RdBu"
) +
tm_borders(col = "white", lwd = 0.5) +  # Add this line
tm_layout(
frame = FALSE,
title = "Percent of Vacancies",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTSINGLES <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTSINGLESst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTSINGLES",
palette = "-RdBu"
) +
tm_borders(col = "white", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Detached Single Homes",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTSINGLES
coefPCTSINGLES <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTSINGLESst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTSINGLES",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Detached Single Homes",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTSINGLES
# PCTVACANT
coefPCTVACANT <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTVACANTst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTVACANT",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Vacancies",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTVACANT
# PCTBACHMOR
coefPCTBACHMOR <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTBACHMORst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTBACHMOR",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Bachelor's or More",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTBACHMOR
# LNNBELPOV
coefLNNBELPOV <- tm_shape(regress_data) +
tm_fill(
col = "coefLNNBELPOVst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: LNNBELPOV",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Number in Poverty (Log)",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefLNNBELPOV
tmap_save(map, filename = "HW2_Plots/coefLNNBELPOV_Map.png", width = 8, height = 8, dpi = 300)
# PCTBACHMOR
coefPCTBACHMOR <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTBACHMORst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTBACHMOR",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Bachelor's or More",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTBACHMOR
tmap_save(map, filename = "HW2_Plots/coefPCTBACHMOR_Map.png", width = 8, height = 8, dpi = 300)
# LNNBELPOV
coefLNNBELPOV <- tm_shape(regress_data) +
tm_fill(
col = "coefLNNBELPOVst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: LNNBELPOV",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Number in Poverty (Log)",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefLNNBELPOV
tmap_save(coefLNNBELPOV, filename = "HW2_Plots/coefLNNBELPOV_Map.png", width = 8, height = 8, dpi = 300)
# PCTBACHMOR
coefPCTBACHMOR <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTBACHMORst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTBACHMOR",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Bachelor's or More",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTBACHMOR
tmap_save(coefPCTBACHMOR, filename = "HW2_Plots/coefPCTBACHMOR_Map.png", width = 8, height = 8, dpi = 300)
coefPCTSINGLES <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTSINGLESst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTSINGLES",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Detached Single Homes",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTSINGLES
tmap_save(coefPCTSINGLES, filename = "HW2_Plots/coefPCTSINGLES_Map.png", width = 8, height = 8, dpi = 300)
# PCTVACANT
coefPCTVACANT <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTVACANTst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTVACANT",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
title = "Percent of Vacancies",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTVACANT
tmap_save(coefPCTVACANT, filename = "HW2_Plots/coefPCTVACANT_Map.png", width = 8, height = 8, dpi = 300)
# LNNBELPOV
coefLNNBELPOV <- tm_shape(regress_data) +
tm_fill(
col = "coefLNNBELPOVst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: LNNBELPOV",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
#title = "Percent of Number in Poverty (Log)",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefLNNBELPOV
#tmap_save(coefLNNBELPOV, filename = "HW2_Plots/coefLNNBELPOV_Map.png", width = 8, height = 8, dpi = 300)
# PCTBACHMOR
coefPCTBACHMOR <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTBACHMORst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTBACHMOR",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
#title = "Percent of Bachelor's or More",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTBACHMOR
#tmap_save(coefPCTBACHMOR, filename = "HW2_Plots/coefPCTBACHMOR_Map.png", width = 8, height = 8, dpi = 300)
coefPCTSINGLES <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTSINGLESst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTSINGLES",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
#title = "Percent of Detached Single Homes",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTSINGLES
#tmap_save(coefPCTSINGLES, filename = "HW2_Plots/coefPCTSINGLES_Map.png", width = 8, height = 8, dpi = 300)
# PCTVACANT
coefPCTVACANT <- tm_shape(regress_data) +
tm_fill(
col = "coefPCTVACANTst",
breaks = c(-Inf, -6, -4, -2, 0, 2, 4, 6, Inf),
title = "Standardized Coef: PCTVACANT",
palette = "-RdBu"
) +
tm_borders(col = "gray", lwd = 0.5) +
tm_layout(
frame = FALSE,
#title = "Percent of Vacancies",
title.position = c("center", "top"),
title.size = 1.2,
legend.position = c("RIGHT", "BOTTOM"),
legend.just = c("right", "bottom"),
legend.bg.color = "white",
legend.bg.alpha = 0.9,
legend.text.size = 0.6,
legend.title.size = 0.6,
inner.margins = c(0.1, 0.15, 0.1, 0.15)
)
coefPCTVACANT
#tmap_save(coefPCTVACANT, filename = "HW2_Plots/coefPCTVACANT_Map.png", width = 8, height = 8, dpi = 300)
tmap_arrange(coefLNNBELPOV, coefPCTBACHMOR, coefPCTSINGLES, coefPCTVACANT, ncol = 2, nrow = 2)
arranged_coef <- tmap_arrange(coefLNNBELPOV, coefPCTBACHMOR, coefPCTSINGLES, coefPCTVACANT, ncol = 2, nrow = 2)
arranged_coef
tmap_save(arranged_coef, filename = "HW2_Plots/arranged_coef_Map.png", width = 8, height = 8, dpi = 300)
OLS.Residuals.Map <- tm_shape(regress_data)+
tm_fill(col='standardised_res',
style='quantile',
title='Standardized OLS Residuals',
palette ='Blues')+
tm_borders(col = "white", lwd = 0.5) +  # Add this line
tm_layout(frame=FALSE, title = 'Standardised OLS Residuals')
OLS.Residuals.Map
OLS.Residuals.Map <- tm_shape(regress_data)+
tm_fill(col='standardised_res',
style='quantile',
title='Standardized OLS Residuals',
palette ='Blues')+
tm_borders(col = "gray", lwd = 0.5) +  # Add this line
tm_layout(frame=FALSE, title = 'Standardised OLS Residuals')
OLS.Residuals.Map
OLS.Residuals.Map <- tm_shape(regress_data)+
tm_fill(col='standardised_res',
style='quantile',
#title='Standardized OLS Residuals',
palette ='Blues')+
tm_borders(col = "gray", lwd = 0.5) +  # Add this line
tm_layout(frame=FALSE, title = 'Standardised OLS Residuals')
OLS.Residuals.Map
OLS.Residuals.Map <- tm_shape(regress_data)+
tm_fill(col='standardised_res',
style='quantile',
title='Standardized OLS Residuals',
palette ='Blues')+
tm_borders(col = "gray", lwd = 0.5) +  # Add this line
tm_layout(frame=FALSE)
OLS.Residuals.Map
tmap_save(OLS.Residuals.Map, filename = "HW2_Plots/OLS_Residuals_Map.png", width = 8, height = 8, dpi = 300)
OLS.Residuals.Map <- tm_shape(regress_data)+
tm_fill(col='standardised_res',
style='quantile',
title='Standardized OLS Residuals',
palette ='Blues')+
tm_borders(col = "gray", lwd = 0.5) +  # Add this line
tm_layout(frame=FALSE, title='Standardized OLS Residuals')
OLS.Residuals.Map
#tmap_save(OLS.Residuals.Map, filename = "HW2_Plots/OLS_Residuals_Map.png", width = 8, height = 8, dpi = 300)
