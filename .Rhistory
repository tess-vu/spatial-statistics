theme_gray()
# Scatter plot of ln(number households in poverty) vs. ln(median house value).
plot_LNNBELPOV100 <- ggplot(regress_data, aes(x = LNNBELPOV100, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Number Households in Poverty vs. Median House Value",
x = "Number Households in Poverty",
y = "Median House Value") +
theme_gray()
# Scatter plot of ln(percent vacant units) vs. ln(median house value).
plot_LNPCTVACANT <- ggplot(regress_data, aes(x = LNPCTVACANT, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Percent Vacant Units vs. Median House Value",
x = "Percent Vacant Units",
y = "Median House Value") +
theme_gray()
# Scatter plot of ln(detached single-family homes) vs. ln(median house value).
plot_LNPCTSINGLES <- ggplot(regress_data, aes(x = LNPCTSINGLES, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Percent Detached Single-Family Homes vs. Median House Value",
x = "Percent Detached Single-Family Homes",
y = "Median House Value") +
theme_gray()
# Create combined scatter plots with 2 rows and 2 columns.
plots_combined <- plot_grid(plot_LNPCTBACHMORE, plot_LNNBELPOV100, plot_LNPCTVACANT, plot_LNPCTSINGLES, ncol = 2, nrow = 2)
# Display plots with annotation.
plots_combined + plot_annotation(
title = "NATURAL LOG: Median House Value Predictors",
subtitle = "Using % Bachelor's Degrees, # Households Below Poverty,\n% Vacant Units, % Detached Single-Family Homes"
)
#| echo: false
#| message: false
#| warning: false
# Fitted.
regress_predicted <- fitted(regress_analysis)
# Residuals.
regress_residuals <- residuals(regress_analysis)
# Standardized residuals.
regress_standard_residuals <- rstandard(regress_analysis)
# Creating new empty dataframe with 3 columns and 1,720 rows for above calculations to store and plot.
predicted_residual_data <- data.frame(matrix(NA, nrow = 1720, ncol = 3))
colnames(predicted_residual_data) <- c("R_PREDICTED", "R_RESIDUALS", "R_STANDARD")
# Store calculated values into new dataframe.
predicted_residual_data <- predicted_residual_data %>%
mutate(
R_PREDICTED = regress_predicted,
R_RESIDUALS = regress_residuals,
R_STANDARD = regress_standard_residuals
)
# Histogram of standardized residuals.
hist_residuals <- ggplot(predicted_residual_data, aes(x = R_STANDARD)) +
geom_histogram(bins = 30, fill = "midnightblue", color = "white", alpha = 0.8) +
labs(title = "Histogram of Standardized Residuals",
x = "Standardized Residuals",
y = "Count") +
theme_minimal()
hist_residuals
#| echo: false
# Scatter plot.
predicted_residual_plot <- ggplot(predicted_residual_data, aes(x = R_PREDICTED, y = R_STANDARD)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "Predicted Values vs. Standardized Residuals",
x = "Predicted Values",
y = "Standardized Residuals") +
theme_gray()
predicted_residual_plot
#| include: false
shapefile$residuals_standardized <- predicted_residual_data$R_STANDARD
#| echo: false
choropleth_residuals <- ggplot() +
geom_sf(data = shapefile, aes(fill = residuals_standardized), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c(option = "viridis") +
labs(title = "Choropleth of Standardized Regression Residuals",
fill = "Standardized Residuals") +
theme_void()
choropleth_residuals
ggsave("choropleth_standardized_residuals.png", plot = choropleth_residuals, width = 8.5, height = 11, dpi = 600)
#| echo: false
step_model <- step(regress_analysis, direction = "both")
step_model$anova
#| echo: false
# Model 1
fit1 <- lm(LNMEDHVAL ~ PCTVACANT + PCTSINGLES, data = regress_data)
#summary(fit1)
#anova(fit1)
cv1 <- CVlm(data = regress_data, form.lm = fit1, m = 5, plotit = FALSE)
# Extract MSE and compute RMSE
mse1 <- attr(cv1, "ms")
rmse1 <- sqrt(mse1)
rmse1
#| echo: false
# Model 2: LNMEDHVAL ~ PCTVACANT + MEDHHINC
fit2 <- lm(LNMEDHVAL ~ PCTVACANT + MEDHHINC, data = regress_data)
#summary(fit2)
#anova(fit2)
cv2 <- CVlm(data = regress_data, form.lm = fit2, m = 5, plotit = FALSE)
mse2 <- attr(cv2, "ms")
rmse2 <- sqrt(mse2)
rmse2
#| message: false
#| warning: false
#| include: false
# Import relevant libraries.
library(MASS)
library(DAAG)
library(corrplot)
library(dplyr)
library(ggplot2)
library(ggcorrplot)
library(patchwork)
library(cowplot)
library(sf)
library(knitr)
library(kableExtra)
library(gridExtra)
# No scientific notation.
options(scipen = 999)
# Read .csv file and store.
regress_data <- read.csv("RegressionData.csv")
# Turn to tibble.
regress_data <- as_tibble(regress_data)
#| include: false
mean_MEDHVAL <- mean(regress_data[["MEDHVAL"]])
sd_MEDHVAL <- sd(regress_data[["MEDHVAL"]])
mean_PCTBACHMOR <- mean(regress_data[["PCTBACHMOR"]])
sd_PCTBACHMOR <- sd(regress_data[["PCTBACHMOR"]])
mean_NBELPOV100 <- mean(regress_data[["NBELPOV100"]])
sd_NBELPOV100 <- sd(regress_data[["NBELPOV100"]])
mean_PCTVACANT <- mean(regress_data[["PCTVACANT"]])
sd_PCTVACANT <- sd(regress_data[["PCTVACANT"]])
mean_PCTSINGLES <- mean(regress_data[["PCTSINGLES"]])
sd_PCTSINGLES <- sd(regress_data[["PCTSINGLES"]])
#| echo: false
# Create data frame for summary statistics table.
sum_stats_table <- data.frame(VARIABLE = c("DEPENDENT VARIABLE", "Median House Value",
"PREDICTORS", "# Households in Poverty",
"% Individuals w/ Bachelor's Degrees or Higher",
"% Vacant Houses", "% Single House Units"))
sum_stats_table <- data.frame(
VARIABLE = c(
"**DEPENDENT VARIABLE**", "Median House Value",
"**PREDICTORS**", "# Households in Poverty",
"% Individuals w/ Bachelor's Degrees or Higher",
"% Vacant Houses", "% Single House Units"
),
MEAN = c(
"", sprintf("$%.2f", mean_MEDHVAL),
"", sprintf("%.2f", mean_NBELPOV100),
sprintf("%.2f%%", mean_PCTBACHMOR),
sprintf("%.2f%%", mean_PCTVACANT),
sprintf("%.2f%%", mean_PCTSINGLES)
),
SD = c(
"", sprintf("$%.2f", sd_MEDHVAL),
"", sprintf("%.2f", sd_NBELPOV100),
sprintf("%.2f%%", sd_PCTBACHMOR),
sprintf("%.2f%%", sd_PCTVACANT),
sprintf("%.2f%%", sd_PCTSINGLES)
)
)
kable(sum_stats_table, digits = 2,
caption = "<b>SUMMARY STATISTICS</b>",
align = c("r", "c", "c"),
format.args = list(big.mark = ",", nsmall = 2)
) %>%
kable_styling(latex_options = "striped") %>%
column_spec(1, bold = TRUE) %>%
row_spec(0, color = "white", background = "black")
#| include: false
# Add new columns at end of tibble dataframe that takes the natural logarithm of median house value (y, response variable) and its x, or predictor variables.
regress_data <- regress_data %>%
mutate(
"LNMEDHVAL" = log(MEDHVAL), # No zero values, can use normal log function.
# Below have 0 values, use log function adding 1.
"LNPCTBACHMORE" = log(1 + PCTBACHMOR),
"LNNBELPOV100" = log(1 + NBELPOV100),
"LNPCTVACANT" = log(1 + PCTVACANT),
"LNPCTSINGLES" = log(1 + PCTSINGLES)
)
#| echo: false
#| message: false
#| warning: false
# Histogram of median household value
medhval_histogram <- ggplot(regress_data, aes(x = MEDHVAL)) +
geom_histogram(fill = "blue2", color = "white") +
scale_x_continuous(labels = scales::dollar_format(prefix = "$", big.mark = ",")) +
labs(
title = "Histogram of Median Household Value",
x = "Median Household Value (Dollars, $)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Histogram of log-transformed values
lnmedhval_histogram <- ggplot(regress_data, aes(x = LNMEDHVAL)) +
geom_histogram(fill = "orange2", color = "white") +
labs(
title = "Histogram of Log(Median Household Value)",
x = "Log(Median Household Value)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Combine side by side
grid.arrange(medhval_histogram, lnmedhval_histogram, ncol = 2)
#| echo: false
#| message: false
#| warning: false
# Histogram of percent bachelor's degrees or more.
pctbachmor_histogram <- ggplot(regress_data, aes(x = PCTBACHMOR)) +
geom_histogram(fill = "blue2", color = "white") +
scale_x_continuous(labels = scales::label_percent(scale = 1, big.mark = ",")) +
labs(
title = "Histogram of Percent Bachelor's+ Degrees",
x = "Percent Bachelor's+ Degrees (Percent, %)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Histogram of log-transformed values.
lnpctbachmor_histogram <- ggplot(regress_data, aes(x = LNPCTBACHMORE)) +
geom_histogram(fill = "orange2", color = "white") +
labs(
title = "Histogram of Log(Percent Bachelor's+ Degrees)",
x = "Log(Percent Bachelor's+ Degrees)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Combine side by side
grid.arrange(pctbachmor_histogram, lnpctbachmor_histogram, ncol = 2)
#| echo: false
#| message: false
#| warning: false
# Histogram of number of households in poverty.
nbelpov_histogram <- ggplot(regress_data, aes(x = NBELPOV100)) +
geom_histogram(fill = "blue2", color = "white") +
scale_x_continuous(labels = scales::comma) +
labs(
title = "Histogram of Number of Households in Poverty",
x = "Number of Households in Poverty",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Histogram of log-transformed values.
lnbelpov_histogram <- ggplot(regress_data, aes(x = LNNBELPOV100)) +
geom_histogram(fill = "orange2", color = "white") +
labs(
title = "Histogram of Log(Number of Households in Poverty)",
x = "Log(Number of Households in Poverty)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Combine side by side
grid.arrange(nbelpov_histogram, lnbelpov_histogram, ncol = 2)
#| echo: false
#| message: false
#| warning: false
# Histogram of percent vacancies.
pctbachmor_histogram <- ggplot(regress_data, aes(x = PCTVACANT)) +
geom_histogram(fill = "blue2", color = "white") +
scale_x_continuous(labels = scales::label_percent(scale = 1, big.mark = ",")) +
labs(
title = "Histogram of Percent Vacancies",
x = "Percent Vacancies (Percent, %)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Histogram of log-transformed values.
lnpctbachmor_histogram <- ggplot(regress_data, aes(x = LNPCTVACANT)) +
geom_histogram(fill = "orange2", color = "white") +
labs(
title = "Histogram of Log(Percent Vacancies)",
x = "Log(Percent Vacancies)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Combine side by side
grid.arrange(pctbachmor_histogram, lnpctbachmor_histogram, ncol = 2)
#| echo: false
#| message: false
#| warning: false
# Histogram of percent detached single house units.
pctbachmor_histogram <- ggplot(regress_data, aes(x = PCTSINGLES)) +
geom_histogram(fill = "blue2", color = "white") +
scale_x_continuous(labels = scales::label_percent(scale = 1, big.mark = ",")) +
labs(
title = "Histogram of Percent Detached Homes",
x = "Percent Detached Homes (Percent, %)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Histogram of log-transformed values.
lnpctbachmor_histogram <- ggplot(regress_data, aes(x = LNPCTSINGLES)) +
geom_histogram(fill = "orange2", color = "white") +
labs(
title = "Histogram of Log(Percent Detached Homes)",
x = "Log(Percent Vacancies)",
y = "Count"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(face = "italic", size = 10),
axis.title.y = element_text(face = "italic", size = 10)
)
# Combine side by side
grid.arrange(pctbachmor_histogram, lnpctbachmor_histogram, ncol = 2)
#| echo: false
shapefile <- st_read("Lecture_1_RegressionData.shp/RegressionData.shp")
choropleth_LNMEDHVAL <- ggplot() +
geom_sf(data = shapefile, aes(fill = LNMEDHVAL), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c() +
labs(title = "Philadelphia Tracts: Log of Median House Value", fill = "Log of Median House Value") +
theme_void()
choropleth_PCTVACANT <- ggplot() +
geom_sf(data = shapefile, aes(fill = PCTVACANT), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c() +
labs(fill = "% Vacant Units") +
theme_void()
choropleth_PCTSINGLES <- ggplot() +
geom_sf(data = shapefile, aes(fill = PCTSINGLES), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c() +
labs(fill = "% Detached Single-Family Homes") +
theme_void()
choropleth_PCTBACHMOR <- ggplot() +
geom_sf(data = shapefile, aes(fill = PCTBACHMOR), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c() +
labs(fill = "% Bachelor's Degrees") +
theme_void()
choropleth_LNNBELPOV100 <- ggplot() +
geom_sf(data = shapefile, aes(fill = LNNBELPOV), color = "black", linewidth = 0.25) +
scale_fill_viridis_c() +
labs(fill = "Households in Poverty") +
theme_void()
plots_combined <- plot_grid(choropleth_PCTVACANT, choropleth_PCTSINGLES, choropleth_PCTBACHMOR, choropleth_LNNBELPOV100, ncol = 2, nrow = 2)
plots_combined + plot_annotation(
title = "Philadelphia Tracts",
subtitle = "Median House Value Predictors"
)
#ggsave("choropleth_combined_map.png", plot = plots_combined, width = 14, height = 8.5, units = "in", dpi = 300)
plots_combined
#| echo: false
correlation_matrix <- cor(regress_data[, c("LNPCTBACHMORE", "LNNBELPOV100", "LNPCTVACANT", "LNPCTSINGLES")],
use = "complete.obs",
method = "pearson")
print(correlation_matrix)
# Create a vector of new names in the desired order
#new_names <- c("ln(% Bachelor's +)", "ln(# Below Poverty)", "ln(% Vacancies)", "ln(% Detached)") # Adjust to your number of variables
# Assign the new names to the dimensions of the matrix
#colnames(correlation_matrix) <- new_names
#rownames(correlation_matrix) <- new_names
ggcorrplot(
correlation_matrix,
type = "full",
lab = TRUE, # Add correlation coefficients
lab_size = 3, # Label size
digits = 2, # Decimal places
hc.order = TRUE, # Hierarchical clustering for variable ordering
outline.col = "white",
ggtheme = ggplot2::theme_gray(),
colors = c("#6D9EC1", "white", "#E46726")
)
#| echo: false
# Regression analysis.
regress_analysis <- lm(LNMEDHVAL ~ PCTVACANT + PCTSINGLES + PCTBACHMOR + LNNBELPOV100, regress_data)
summary(regress_analysis)
#| echo: false
# Scatter plot of ln(percent bachelor's degrees) vs. ln(median house value).
plot_LNPCTBACHMORE <- ggplot(regress_data, aes(x = LNPCTBACHMORE, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Percent Bachelor's Degree vs. Median House Value",
x = "Percent Bachelor's Degree",
y = "Median House Value") +
theme_gray()
# Scatter plot of ln(number households in poverty) vs. ln(median house value).
plot_LNNBELPOV100 <- ggplot(regress_data, aes(x = LNNBELPOV100, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Number Households in Poverty vs. Median House Value",
x = "Number Households in Poverty",
y = "Median House Value") +
theme_gray()
# Scatter plot of ln(percent vacant units) vs. ln(median house value).
plot_LNPCTVACANT <- ggplot(regress_data, aes(x = LNPCTVACANT, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Percent Vacant Units vs. Median House Value",
x = "Percent Vacant Units",
y = "Median House Value") +
theme_gray()
# Scatter plot of ln(detached single-family homes) vs. ln(median house value).
plot_LNPCTSINGLES <- ggplot(regress_data, aes(x = LNPCTSINGLES, y = LNMEDHVAL)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "LOG: Percent Detached Single-Family Homes vs. Median House Value",
x = "Percent Detached Single-Family Homes",
y = "Median House Value") +
theme_gray()
# Create combined scatter plots with 2 rows and 2 columns.
plots_combined <- plot_grid(plot_LNPCTBACHMORE, plot_LNNBELPOV100, plot_LNPCTVACANT, plot_LNPCTSINGLES, ncol = 2, nrow = 2)
# Display plots with annotation.
plots_combined + plot_annotation(
title = "NATURAL LOG: Median House Value Predictors",
subtitle = "Using % Bachelor's Degrees, # Households Below Poverty,\n% Vacant Units, % Detached Single-Family Homes"
)
#| echo: false
#| message: false
#| warning: false
# Fitted.
regress_predicted <- fitted(regress_analysis)
# Residuals.
regress_residuals <- residuals(regress_analysis)
# Standardized residuals.
regress_standard_residuals <- rstandard(regress_analysis)
# Creating new empty dataframe with 3 columns and 1,720 rows for above calculations to store and plot.
predicted_residual_data <- data.frame(matrix(NA, nrow = 1720, ncol = 3))
colnames(predicted_residual_data) <- c("R_PREDICTED", "R_RESIDUALS", "R_STANDARD")
# Store calculated values into new dataframe.
predicted_residual_data <- predicted_residual_data %>%
mutate(
R_PREDICTED = regress_predicted,
R_RESIDUALS = regress_residuals,
R_STANDARD = regress_standard_residuals
)
# Histogram of standardized residuals.
hist_residuals <- ggplot(predicted_residual_data, aes(x = R_STANDARD)) +
geom_histogram(bins = 30, fill = "midnightblue", color = "white", alpha = 0.8) +
labs(title = "Histogram of Standardized Residuals",
x = "Standardized Residuals",
y = "Count") +
theme_minimal()
hist_residuals
#| echo: false
# Scatter plot.
predicted_residual_plot <- ggplot(predicted_residual_data, aes(x = R_PREDICTED, y = R_STANDARD)) +
geom_point(size = 2, alpha = 0.3, color = "midnightblue") +
labs(title = "Predicted Values vs. Standardized Residuals",
x = "Predicted Values",
y = "Standardized Residuals") +
theme_gray()
predicted_residual_plot
#| include: false
shapefile$residuals_standardized <- predicted_residual_data$R_STANDARD
#| echo: false
choropleth_residuals <- ggplot() +
geom_sf(data = shapefile, aes(fill = residuals_standardized), color = "cornsilk2", linewidth = 0.25) +
scale_fill_viridis_c(option = "viridis") +
labs(title = "Choropleth of Standardized Regression Residuals",
fill = "Standardized Residuals") +
theme_void()
choropleth_residuals
ggsave("choropleth_standardized_residuals.png", plot = choropleth_residuals, width = 8.5, height = 11, dpi = 600)
#| echo: false
step_model <- step(regress_analysis, direction = "both")
step_model$anova
#| echo: false
# Model 1
fit1 <- lm(LNMEDHVAL ~ PCTVACANT + PCTSINGLES, data = regress_data)
#summary(fit1)
#anova(fit1)
cv1 <- CVlm(data = regress_data, form.lm = fit1, m = 5, plotit = FALSE)
# Extract MSE and compute RMSE
mse1 <- attr(cv1, "ms")
rmse1 <- sqrt(mse1)
rmse1
#| echo: false
# Model 2: LNMEDHVAL ~ PCTVACANT + MEDHHINC
fit2 <- lm(LNMEDHVAL ~ PCTVACANT + MEDHHINC, data = regress_data)
#summary(fit2)
#anova(fit2)
cv2 <- CVlm(data = regress_data, form.lm = fit2, m = 5, plotit = FALSE)
mse2 <- attr(cv2, "ms")
rmse2 <- sqrt(mse2)
rmse2
